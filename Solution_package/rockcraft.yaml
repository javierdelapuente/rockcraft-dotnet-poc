name: my-rock-name
# see https://documentation.ubuntu.com/rockcraft/en/latest/explanation/bases/
# for more information about bases and using 'bare' bases for chiselled rocks
base: ubuntu@24.04 # the base environment for this rock
version: '0.1' # just for humans. Semantic versioning is recommended
summary: Single-line elevator pitch for your amazing rock # 79 char long summary
# run-user: _daemon_
description: |
    This is my-rock-name's description. You have a paragraph or two to tell the
    most important story about it. Keep it under 100 words though,
    we live in tweetspace and your description wants to look good in the
    container registries out there.
platforms: # the platforms this rock should be built on and run on
    amd64:

parts:
  try-with-solution-and-output:
    build-packages:
      - dotnet8
    # user `plugin: dump` and `source: .` as an alternative, and dotnet publish
    # will not need a reference to CRAFT_PROJECT_DIR
    plugin: nil
    stage-packages:
      - libicu74
    override-build: |
      dotnet clean "${CRAFT_PROJECT_DIR}" --output "${CRAFT_PART_INSTALL}"
      # Ugly warning NETSDK1194 for --output being problematic as all projects are copied to the same place
      dotnet publish "${CRAFT_PROJECT_DIR}" --self-contained --output "${CRAFT_PART_INSTALL}"


  # try-with-project:
  #   build-packages:
  #     - dotnet8
  #   # user `plugin: dump` and `source: .` as an alternative, and dotnet publish
  #   # will not need a reference to CRAFT_PROJECT_DIR
  #   plugin: nil
  #   stage-packages:
  #     - libicu74
  #   override-build: |
  #     dotnet clean "${CRAFT_PROJECT_DIR}" --output "${CRAFT_PART_INSTALL}"
  #     # This does not show any warning, but implies knowledge... (or parsing csproj files)
  #     # However,  -p:AssemblyName=myapp can not be set, it says Ambiguous project name 'myapp', not sure sure why.
  #     dotnet publish "${CRAFT_PROJECT_DIR}/MyWebApp" --self-contained --output "${CRAFT_PART_INSTALL}"

services:
  dotnet:
    override: replace
    # TODO unfortunately, we need the project name. How to get it? There could be several ones.
    command: /MyWebApp
    startup: enabled
    # user: _daemon_
    environment:
      # https://learn.microsoft.com/en-us/aspnet/core/fundamentals/host/web-host?view=aspnetcore-9.0&preserve-view=true#server-urls
      ASPNETCORE_URLS: "http://*:5000"
